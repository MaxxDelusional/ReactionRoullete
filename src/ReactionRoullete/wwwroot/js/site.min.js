function PostBlob(e,o,r){var d=new FormData;d.append(o,r),d.append(o+"-blob",e),xhr(callbackurl,d,null,null,function(e){})}function xhr(e,o,r,d,t){var i=new XMLHttpRequest;i.onreadystatechange=function(){4==i.readyState&&200==i.status&&t&&t(i.responseText)},-1==e.indexOf("/RecordRTC/DeleteFile")&&(d&&(i.upload.onloadstart=function(){d.innerHTML="Upload started..."}),r&&(i.upload.onprogress=function(e){r.max=e.total,r.value=e.loaded,d.innerHTML="Upload Progress "+Math.round(e.loaded/e.total*100)+"%"}),d&&(i.upload.onload=function(){d.innerHTML="Saved!"})),i.open("POST",e),i.send(o)}var record=document.getElementById("React"),stop=document.getElementById("Stop"),recordVideo=document.getElementById("record-video"),preview=document.getElementById("preview"),container=document.getElementById("container"),isFirefox=!!navigator.mozGetUserMedia,recordAudio,recordVideo;record.onclick=function(){record.disabled=!0,navigator.getUserMedia({audio:!1,video:!0},function(e){preview.src=window.URL.createObjectURL(e),preview.play(),recordAudio=RecordRTC(e,{onAudioProcessStarted:function(){isFirefox||recordVideo.startRecording()}}),isFirefox&&recordAudio.startRecording(),isFirefox||(recordVideo=RecordRTC(e,{type:"video"}),recordAudio.startRecording()),stop.disabled=!1},function(e){alert(JSON.stringify(e,null,"	"))})};var fileName;stop.onclick=function(){record.disabled=!1,stop.disabled=!0,preview.src="",fileName=Math.round(99999999*Math.random())+99999999,isFirefox&&recordAudio.stopRecording(function(e){preview.src=e,PostBlob(recordAudio.getBlob(),"video",fileName+".webm")}),isFirefox||recordVideo.stopRecording(function(){PostBlob(recordVideo.getBlob(),"video",fileName+".webm")})},window.onbeforeunload=function(){return fileName?"It seems that you've not deleted audio/video files from the server.":void 0},navigator.getUserMedia({audio:!1,video:!0},function(e){},function(e){});